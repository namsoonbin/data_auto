# 판매 데이터 자동화 애플리케이션

## 1. 프로젝트 목표

네이버 스마트스토어 판매자 센터에서 다운로드한 판매 데이터를 기반으로, 복잡한 데이터 처리 및 분석 과정을 자동화하고, 사용자 친화적인 애플리케이션을 통해 일간/주간/월간 리포트 및 시각화 대시보드를 제공하는 것을 최종 목표로 합니다.

## 2. 핵심 기능

-   **스마트 폴더:** 지정된 폴더에 엑셀 파일을 넣기만 하면 모든 프로세스가 자동 시작됩니다.
-   **데이터 자동 처리:** 여러 스토어의 '상품성과', '주문조회' 파일을 자동으로 취합하고, '마진정보'와 병합하여 매출, 순매출, 판매마진, 광고비율 등 핵심 지표를 계산합니다.
-   **주기별 리포트 생성:** 처리된 데이터를 바탕으로 일간, 주간, 월간 통합 리포트를 엑셀 파일로 생성합니다.
-   **시각화 대시보드:** 생성된 리포트 데이터를 기반으로 주요 지표와 트렌드를 한눈에 파악할 수 있는 웹 대시보드를 제공합니다.

## 3. 개발 계획

### Phase 1: 지능형 데이터 처리기 개발

수동 작업을 최소화하고, 리포팅 기능을 강화하여 자동화의 핵심 기반을 구축합니다.

-   **1단계: '스마트 폴더' 기능 개발**
    -   **목표:** 사용자가 다운로드한 파일을 특정 폴더에 넣는 것만으로 자동화를 실행합니다.
    -   **액션:**
    1.  사용자가 파일을 저장할 '다운로드 폴더'를 지정할 수 있게 합니다.
    2.  프로그램이 해당 폴더를 **주기적으로 확인**하여, '상품성과' 및 '주문조회' 파일이 들어오면 파일명을 규칙에 맞게 자동 변경합니다.
    3.  관련 파일이 모두 준비되면, 메인 데이터 처리 스크립트(`main.py`)를 자동으로 실행하여 리포트를 생성합니다.

-   **현재 상태 (2025년 9월 1일 최종 업데이트):**
    -   **모듈화 완료:** 코드를 `modules/` 폴더로 완전 모듈화하여 유지보수성과 확장성을 대폭 향상시켰습니다.
        - `modules/config.py`: 중앙 설정 관리, 순이익 컬럼 추가
        - `modules/file_handler.py`: 파일 처리 및 모니터링, 자동화 버그 수정
        - `modules/report_generator.py`: 리포트 생성 로직, GUI 리워드 관리 시스템
    -   **데스크톱 애플리케이션 완성:** PyQt5 기반 GUI 애플리케이션(`desktop_app.py`) 완성
        - 직관적인 사용자 인터페이스
        - 실시간 로그 표시
        - 자동화 시작/중지 기능
        - 수동 작업폴더 처리 기능 (중지 기능 포함)
        - 암호 보호된 Excel 파일 지원
        - **신규**: GUI 리워드 관리 시스템 (날짜별 상품 리워드 설정)
    -   **자동화 처리 버그 완전 수정:** 파일이 작업폴더로 이동되지만 리포트가 생성되지 않던 문제 해결
        - 조기 정리 로직 제거로 모든 파일 처리 완료 후 일괄 정리 방식 적용
    -   **순이익 컬럼 추가:** 새로운 핵심 지표 '순이익' = 판매마진 - 가구매 비용 - 리워드
    -   **암호 보호 Excel 파일 지원:** `msoffcrypto-tool` 라이브러리를 사용하여 암호 보호된 주문조회 파일 자동 처리
    -   **지연된 정리(Delayed Cleanup) 방식:** 백업 파일 과다 생성 문제 해결
        - 개별 리포트 생성과 파일 정리 분리
        - 전체 통합 리포트 중복 생성 방지
        - 파일 이동 최적화
    -   **향상된 폴더 구조:**
        - `작업폴더`: 데이터 처리 작업 공간
        - `원본_보관함`: 처리 완료된 원본 파일 보관
        - `리포트보관함`: 생성된 리포트 파일 보관
    -   **수량 데이터 소스 변경:** 리포트의 수량 값을 상품성과 파일의 '결제상품수량'에서 가져오도록 개선
    -   **실행 파일 배포:** PyInstaller를 사용하여 독립 실행 가능한 `.exe` 파일 생성 완료

-   **2단계: 주간/월간 리포트 기능 추가**
    -   **목표:** 일일 리포트를 기반으로 주간 및 월간 데이터를 집계합니다.
    -   **액션:** `main.py` 스크립트를 수정하여, 특정 기간(주/월)의 일일 리포트들을 모두 읽어와 합산하고, 현재와 동일한 형식의 `주간_통합_리포트.xlsx`, `월간_통합_리포트.xlsx` 파일을 생성하는 기능을 추가합니다.

-   **3단계: 핵심 로직 모듈화 (리팩토링)**
    -   **목표:** 코드의 재사용성과 유지보수성을 높여 향후 기능 확장을 용이하게 합니다.
    -   **액션:** `main.py`의 코드를 '파일 탐색', '데이터 처리', '리포트 생성' 등 명확한 기능 단위로 분리하고 재구성합니다.

### Phase 2: 사용자 친화적 애플리케이션 개발

완성된 자동화 로직을 다른 사람도 쉽게 사용할 수 있는 프로그램 형태로 만듭니다.

-   **4단계: 데스크톱 애플리케이션 UI 개발**
    -   **목표:** 클릭 몇 번으로 모든 프로세스를 실행하고 관리할 수 있는 사용자 인터페이스(UI)를 개발합니다.
    -   **액션:** Python의 `PyQt` 또는 `Tkinter` 라이브러리를 사용하여 데스크톱 프로그램을 개발합니다. UI에는 '스마트 폴더' 위치 지정, 자동화 실행 버튼, 날짜별 리포트 생성, 진행 상황 로그 표시 창 등의 기능을 포함합니다.

-   **현재 상태 (2025년 8월 29일 업데이트):**
    -   **완전한 GUI 애플리케이션:** `desktop_app.py` 완성으로 사용자 친화적인 인터페이스 제공
    -   **핵심 기능들:**
        - 다운로드 폴더 선택 및 설정
        - 암호 입력 필드 (주문조회 파일용)
        - 자동화 시작/중지 버튼
        - 작업폴더 처리 (수동) 버튼
        - 실시간 진행 상황 표시
        - 상세한 로그 출력
    -   **스레드 안정성:** Worker 스레드 관리 개선으로 UI 응답성과 안정성 확보
    -   **메모리 누수 방지:** 적절한 스레드 정리 및 메모리 관리
    -   **실행 파일 배포:** PyInstaller로 독립 실행 가능한 `.exe` 파일 생성
        - 파일 위치: `dist/판매데이터자동화.exe`
        - 마진정보.xlsx 파일 외부 관리로 수정 용이성 확보

-   **5단계: 대시보드 개선**
    -   **목표:** 웹 대시보드에서 일간/주간/월간 데이터를 손쉽게 전환하며 볼 수 있도록 기능을 강화합니다.
    -   **액션:** `app.py`와 `index.html`을 수정하여, 대시보드에 **[일간/주간/월간 보기]** 선택 필터를 추가하고, 사용자의 선택에 따라 해당 기간의 데이터를 동적으로 불러와 보여주도록 개선합니다.

-   **6단계: 실행 파일 배포 ✅ 완료**
    -   **목표:** 완성된 프로그램을 다른 사용자가 파이썬이나 관련 라이브러리 설치 없이도 쉽게 실행할 수 있도록 합니다.
    -   **액션:** `PyInstaller`와 같은 패키징 도구를 사용하여, 전체 프로젝트를 하나의 실행 파일(`.exe`)로 만듭니다.

## 4. 기술적 개선사항 (2025년 9월 1일 최종)

### 🏗️ **아키텍처 개선**
- **모듈화**: 단일 파일에서 모듈 기반 구조로 전환
- **관심사 분리**: 설정, 파일 처리, 리포트 생성을 독립적인 모듈로 분리
- **코드 재사용성**: 공통 기능의 모듈화로 중복 코드 제거

### 🔧 **핵심 기능 개선**
- **자동화 처리 버그 수정**: 파일 이동 후 리포트 미생성 문제 완전 해결
- **순이익 컬럼 추가**: 판매마진 - 가구매 비용 - 리워드 계산
- **GUI 리워드 관리**: 날짜별 상품 리워드 설정 시스템 구현
- **지연된 정리(Delayed Cleanup)**: 백업 파일 과다 생성 문제 해결
- **스마트 백업**: 파일 크기 비교를 통한 실제 변경 시에만 백업 생성
- **워크플로우 재개**: 중단된 작업의 자동 감지 및 재개 기능
- **멀티 스레딩**: UI 응답성을 위한 백그라운드 처리
- **수동 처리 중지**: 작업폴더 처리에도 중지 기능 추가

### 🛡️ **보안 및 안정성**
- **암호화 파일 지원**: msoffcrypto-tool을 통한 암호 보호 Excel 파일 처리
- **경로 보안**: 디렉토리 탐색 공격 방지를 위한 경로 검증
- **에러 핸들링**: 포괄적인 예외 처리 및 복구 메커니즘
- **메모리 관리**: 메모리 누수 방지 및 리소스 정리

### 📊 **데이터 처리 개선**
- **수량 데이터 소스 변경**: 상품성과 파일의 '결제상품수량' 활용
- **벡터화 연산**: pandas 최적화를 통한 성능 향상
- **데이터 무결성**: 중복 처리 방지 및 정확한 집계
- **리워드 계산 최적화**: 대표옵션에만 고정값 적용
- **퍼센트 표시 개선**: 마진율, 광고비율, 이윤율 소수점 첫째자리 표시
- **안전한 계산**: 무한대, NaN 값 처리 개선

### 🖥️ **사용자 경험**
- **직관적 UI**: PyQt5 기반의 현대적이고 사용하기 쉬운 인터페이스
- **실시간 피드백**: 진행 상황 및 로그의 실시간 표시
- **원클릭 배포**: 독립 실행 파일로 간편한 배포 및 사용
- **GUI 리워드 관리**: 날짜별 상품 리워드 설정을 위한 전용 다이얼로그
- **중지 기능 완비**: 자동화 및 수동 처리 모두 중지 가능

## 5. 파일 구조

```
data_automation/
├── desktop_app.py          # 메인 GUI 애플리케이션
├── main.py                 # 콘솔 버전 (레거시)
├── requirements.txt        # 의존성 패키지 목록
├── 마진정보.xlsx           # 마진 정보 데이터
├── modules/               # 모듈 디렉토리
│   ├── __init__.py
│   ├── config.py          # 설정 관리
│   ├── file_handler.py    # 파일 처리 및 모니터링
│   └── report_generator.py # 리포트 생성
└── dist/                  # 배포용 실행 파일
    ├── 판매데이터자동화.exe
    └── 마진정보.xlsx
```

## 6. 사용 방법

### GUI 버전 (권장)
1. `dist/판매데이터자동화.exe` 실행
2. 다운로드 폴더 선택
3. 주문조회 파일 암호 입력 (기본: 1234)
4. "자동화 시작" 버튼 클릭 (중지 가능)
5. 또는 "작업폴더 처리" 버튼으로 수동 처리 (중지 가능)
6. **신규**: "리워드 관리" 버튼으로 상품별 리워드 설정

### 리워드 관리 시스템
- **설정 방법**: 시작일, 종료일, 상품ID, 리워드 금액 입력
- **빠른 설정**: 0원, 3000원, 6000원, 9000원 버튼 활용
- **적용 방식**: 대표옵션에만 고정값 적용 (판매개수 무관)
- **저장 위치**: `리워드설정.json` 파일로 관리

### 새로운 기능
- **순이익 컬럼**: 판매마진에서 가구매 비용과 리워드를 뺀 실제 순이익 표시
- **향상된 안정성**: 자동화 처리 버그 완전 해결
- **중지 기능**: 모든 처리 과정에서 중지 가능

### 개발 환경
1. 의존성 설치: `pip install -r requirements.txt`
2. GUI 실행: `python desktop_app.py`
3. 콘솔 실행: `python main.py [다운로드_폴더_경로]`
